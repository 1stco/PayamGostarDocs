# ثبت پرداخت از طریق اکسل
در صورت نیاز به ورود تعدادی پرداخت به صورت یکجا می‌توانید از روش ورود اکسلی استفاده نمایید. بدین ترتیب می‌توانید اطلاعات پرداخت‌های مورد نظر را در اکسل درج نمایید (یا از سایر نرم‌افزارهای خود خروجی بگیرید) و سپس بارگذاری کنید. در این حالت پرداخت‌های مورد نظر ایجاد شده و اطلاعات آن در فیلدهای مربوطه وارد می‌شود. علاوه بر آن از این روش می‌توانید برای ویرایش اطلاعات پرداخت‌های موجود استفاده نمایید.<br>
برای اینکه ورود اطلاعات بدون مواجهه با خطا و با موفقیت به اتمام برسد،‌ در این مقاله تمامی موارد لازم به همراه شیوه بارگذاری مطرح شده است. بر این اساس مقاله شامل عناوین زیر می‌باشد:

- [شیوه‌ی تهیه و تنظیم فایل اکسل پرداخت‌ها](#PaymentExcelSetting)
- [روش بارگذاری فایل اکسل پرداخت‌ها](#PaymentExcelUploading)
- [مجوزهای لازم برای بارگذاری اکسل پرداخت‌ها](#PaymentExcelPermision)

## تنظیمات فایل اکسل{#ReceiptExcelSetting}
برای بارگذاری و ورود اطلاعات پرداخت‌ها از طریق اکسل، ابتدا باید اکسل مورد نظر را بر اساس فرمت مورد پذیرش نرم‌افزار تنظیم کنید.  بدین منظور می‌توانید از فایل نمونه استفاده نمایید. فایل نمونه را می‌توانید از سایت **پیام‌گستر** دانلود کنید.
برای تکمیل فایل اکسل، به موارد زیرتوجه فرمایید:
در تهیه اکسل توجه داشته باشید که تمامی اطلاعات در یک Sheet ذخیره شده باشد. در غیر این صورت بارگذاری اکسل با موفقیت انجام نخواهد شد.
امکان بارگذاری انواع پرداخت به صورت یکجا (با استفاده از یک اکسل) وجود ندارد.
در صورت استفاده از اکسل نمونه‌ی موجود در سایت،‌ فرمت و کامنت‌های آن را حذف نمایید. بدین منظور جدول را نتخاب کرده و از Clear Comment و Clear Format استفاده نمایید.

![نمونه اکسل پرداخت](./Images/payment-excel-sample.png)

تصویر فوق،‌ ستون‌های مورد نیاز برای بارگذاری پرداخت‌ را بر اساس فیلدهای پیش‌فرض نشان می‌دهد.
برای تکمیل اطلاعات مربوط به فیلدهای پیش‌فرض به راهنمایی‌های زیر توجه داشته باشید:
- **پروفایل مرتبط:** نام هویت و یا شماره مشتری را در این قسمت وارد نمایید.
- **توضیحات:** در صورت نیاز توضیحات پرداخت را در این قسمت درج نمایید.
- **مبلغ نهایی:** مبلغ مورد نظر (مبلغ پرداخت شده) را در این ستون وارد نمایید. توجه داشته باشید مبلغ را به ریال درج کنید.
- **شماره**:  شماره پرداخت را بر اساس الگوی شماره‌گذاری‌ای که برای آن تعریف شده است مشخص نمایید. برای ثبت درست شماره بر اساس الگوی شماره‌گذاری، آخرین شماره‌ی اختصاص داده شده به آخرین پرداخت ثبت شده‌ در سیستم را چک کرده و شماره‌ی بعدی را به اولین پرداخت مندرج اکسل خود اختصاص دهید.

> **نکته**<br>
>  در حالت پیش‌فرض،‌ «شماره» در مرحله‌ی بعد مبنای شناسایی انتخاب می‌شود. در نتیجه درج آن الزامی است. مگر اینکه فیلد دیگری به عنوان مبنای شناسایی انتخاب گردد.<br>

- **حساب عامل:** حسابی که مبلغ از آن برداشت شده است را در این ستون درج نمایید. توجه داشته باشید حساب درج شده در این قسمت باید از بین حساب‌های تعریف شده در نرم‌افزار انتخاب شود. (برای بررسی این موضوع کافیست یک پرداخت جدید از زیرنوع مورد نظر باز کرده و لیست «برداشت از» را بررسی کنید)

- **نوع:** نوع پرداخت را از بین گزینه‌های نقدی، چکی و اعتباری انتخاب نمایید. توجه داشته باشید که نوع انتخابی،‌ در زیرنوع پرداختی که قصد بارگذاری آن را دارید فعال  باشد (برای بررسی این موضوع کافیست یک پرداخت جدید از زیرنوع مورد نظر باز کرده و لیست نوع پرداخت را بررسی کنید).
- **تاریخ سررسید:** در صورت انتخاب نوع پرداخت چکی یا اعتباری، تاریخ سررسید پرداخت را در این ستون وارد نمایید.
- **نحوه انجام:** صورت انتخاب نوع پرداخت نقدی، روش پرداخت را از بین گزینه‌های کارت به کارت، واریز به حساب بانکی،‌ پرداخت آنلاین، پرداخت حضوری و لینک پیام گستر پرداخت انتخاب نمایید.
مشخص کنید.
- **تاریخ انجام:** تاریخ پرداخت را در این ستون درج نمایید.
- **نوع بانک:** در صورت انتخاب نوع پرداخت چکی، نام بانک را در این ستون وارد نمایید. توجه داشته باشید که نام بانک را از بین بانک‌های تعریف شده در نرم‌افزار انتخاب کنید. (برای بررسی این موضوع یک پرداخت جدید از زیرنوع انتخابی را باز کرده، نوع را بر روی چکی تنظیم کرده و در لیست بانک،‌ اسامی موجود را مشاهده نمایید ).
- **شماره کارت پرداخت:** در صورت انتخاب نوع پرداخت نقدی، شماره کارت را در این ستون وارد نمایید.
- **کد شعبه:** در صورت انتخاب نوع پرداخت نقدی، کد شعبه را در این ستون وارد نمایید.
- **شماره پیگیری:** در صورت انتخاب نوع پرداخت نقدی، شماره پیگیری را در این ستون وارد نمایید.
- **شماره چک:** در صورت انتخاب نوع پرداخت چکی، شماره چک را در این ستون وارد نمایید.

چنانچه زیرنوع پرداخت مورد نظر دارای فیلدهای اضافه (اضافه شده در شخصی‌سازی) می‌باشد، ستونی هم نام با فیلد خود به ستون‌های موجود در اکسل اضافه و اطلاعات مورد نظر را در ستون مربوطه وارد نمایید. در این خصوص به نکات زیر توجه داشته باشید:<br>
- امکان ورود اطلاعات فیلدهایی از نوع فایل، تصویر، html، کمپین، برچسب، لیست مرتبط، فیلد آیتم‌های CRM (مثل فیلد پرداخت،‌فاکتور و... به جز فیلد شخص/شرکت)، فیلد اضافه از نوع رنگ، فیلد لیستی از نوع فایل و فیلد لیستی از نوع کاربر/گروه از طریق اکسل وجود ندارد.
- در صورت استفاده از فیلد چک باکس،‌ با استفاده از «بلی» چک باکس تیک خورده و در صورت ذکر «خیر» چک باکس بدون تیک لحاظ می‌شود. البته از عبارات yes/no و true/false و همچنین اعداد 1/0 نیز می‌توانید بدین منظور استفاده نمایید.
- در صورت استفاده از فیلد کاربر، از بین کاربران تعریف شده در نرم‌افزار نام کاربر و یا کد کاربر مورد نظر را در این قسمت درج نمایید.
- برای ورود اطلاعات به فیلدهایی از نوع لیست کشویی فقط از عبارات موجود در لیست می‌توانید استفاده نمایید. فیلدهای لیست کشویی پیش‌فرض نرم‌افزار در بخش مدیریت آیتم‌های سیستم و لیست‌های کشویی اضافه‌ شده توسط شما در بخش شخصی‌سازی آن آیتم قابل مشاهده و ویرایش می‌باشند. چنانچه برای یک فیلد لیست کشویی، دو گزینه با عنوان مشابه تعریف شده باشد، ورود اطلاعات (مقداردهی) آن از طریق اکسل با خطا مواجه می‌شود.

> **نکته**<br>
> برای بارگذاری اکسل پرداخت، درج «مرتبط با»، «مبلغ نهایی» و «شماره» الزامی است.<br>

## مراحل بارگذاری فایل اکسل{PaymentExcelUploading}
برای بارگذاری فایل اکسل پرداخت‌ها به این ترتیب اقدام نمایید:
### بارگذاری فایل
برای ورود اطلاعات می‌توانید در لیست پرداخت‌ها از کلید ورود اطلاعات از طریق اکسل اقدام نمایید.
در گام اول نوع و زیر نوع آیتم انتخاب شده نمایش داده می‌شود.<br>
اگر لیست آیتم‌ها بر روی نمایش همه(برای مثال همه‌ی پرداخت‌ها) باشد، در این گام  زیر نوع بصورت خودکار نمایش داده می‌شود که می‌توان آن را ویرایش کرد.<br>
فایل اکسل را از مسیر **پرداخت** > **ورود اطلاعات از اکسل** دانلود کنید.

![مسیر ورود اکسل پرداخت](./Images/payment-excel-upload_2.8.3.png)

>**نکته**<br>
قبل از بارگذاری فایل اکسل نمونه می بایست **نوع** و **زیر نوع آیتم** را مشخص کنید.
>>**نکته**<br> چنانچه در شخصی سازی CRM فیلدهایی در گروه فیلد تعریف کرده باشید، این فیلد ها به عنوان ستون‌های اکسل در فایل نمونه درج خواهد شد.

با کلیک بر روی «فایل نمونه» می‌توانید اکسل نمونه برای تهیه اکسل پرداخت‌ با فرمت صحیح را پرداخت‌ نمایید. چنانچه از راهنمای بالا برای تهیه اکسل خود استفاده کرده‌اید نیاز به دانلود این فایل نیست.
در این مرحله فایل اکسل خود را انتخاب (شماره ۳) یا از طریق drag & drop بارگذاری کنید. پس از بارگذاری فایل،‌ کلید «مرحله بعد» (شماره ۴) فعال می‌شود.

### تنظیمات بارگذاری فایل
در این بخش باید تنظیمات لازم جهت تعیین روش ورود اطلاعات را مشخص کنید.

![تنظیمات بارگذاری اکسل پرداخت](./Images/payment-excel-setting_2.8.3.png)

**1. افزودن اطلاعات جدید**<br>
با انتخاب این گزینه، تمامی پرداخت‌های جدید موجود در اکسل بر اساس مبنای در نظر گرفته شده (مثل شماره پرداخت‌) شناسایی و بارگذاری می‌شود. چنانچه قصد بارگذاری پرداخت‌های جدید در سیستم را دارید (منظور از پرداخت‌ جدید پرداخت‌هایی است که پیش‌تر در سیستم وجود نداشته) این گزینه را انتخاب کرده و در کادر پایین، «شماره» را به عنوان مبنای شناسایی انتخاب کنید. برای نمایش این گزینه در کادر،‌ بر روی آیکون طوسی رنگ سمت چپ کادر کلیک کنید.<br>
 بدیهی است در صورت یکسان بودن شماره‌ی پرداخت‌ درج شده در اکسل با یکی از پرداخت‌های موجود در سیستم، پرداخت‌ تکراری در نظر گرفته شده و بارگذاری نمی‌شود.<br>
**2. ‌ویرایش اطلاعات موجود**<br>
در این حالت براساس شماره پرداخت‌ (فیلد مبنا)، جستجو انجام می‌شود. در صورت وجود پرداخت‌ با شماره مشابه در نرم‌افزار، اطلاعات پرداخت‌ مربوطه ویرایش شده و اطلاعات موجود در اکسل برای آن درج می‌شود. در صورت یافت نشدن پرداخت‌ با شماره مشابه،‌ اطلاعات آن سطر از اکسل بارگذاری نخواهد شد.
برای انتخاب این گزینه، در قسمت کادر پایین بر روی آیکون طوسی رنگ سمت چپ کلیک کرده و «شماره» را به عنوان فیلد مبنا انتخاب کنید.<br>

> **نکته**<br>
> در هنگام ویرایش، باید زیر نوع پرداخت‌ در حال ویرایش و زیر نوع آیتم انتخاب شده در گام اول یکسان باشد؛ در غیر این صورت بارگذاری انجام نمی‌شود.

با انتخاب چک باکس " فقط فیلد‌های خالی پر شوند" تنها فیلدهای خالی پرداختت‌های موجود مقداردهی شده و فیلدهایی که دارای اطلاعات می‌باشند بدون تغییر باقی می‌مانند.<br>

**3. افزودن و ویرایش**<br>
در این حالت براساس شماره پرداخت‌ (فیلد مبنا)، جستجو انجام می‌شود. در صورت وجود پرداخت‌ با شماره درج شده در اکسل، دریافت مربوطه ویرایش می‌شود و در صورت یافت نشدن پرداخت‌ با این شماره، ردیف مربوطه به عنوان پرداخت‌ جدید در نرم‌افزار ثبت می‌شود.<br>
با انتخاب چک باکس " فقط فیلد‌های خالی پر شوند"،‌ در پرداخت‌هایی که نیازمند ویرایش می‌باشند (دریافت‌هایی که شماره آن‌ها پیش‌تر در سیستم وجود داشته)، ‌تنها فیلدهای خالی مقداردهی شده و فیلدهایی که دارای اطلاعات می‌باشند بدون تغییر باقی می‌مانند.


>**نکته**<br>
در حالت ویرایش (حالت ۲ و ۳)، چنانچه بر اساس مبنای جستجو، چند دریافت با اطلاعات مورد نظر یافت شود، (مثلا در حالتی که مبنا شماره پرداخت است،‌ چند هویت دارای یک شماره پرداخت یکسان باشند) ویرایش بر روی هیچ یک از هویت‌ها انجام نمی‌گیرد.

در زمان ویرایش، مقادیر جایگزین مقادیر قبلی می‌شوند. بنابراین در صورتی که نیاز است مقادیر جدید بدون حذف مقادیر قبلی اضافه شوند، باید مقادیر قبلی موجود هر فیلد که قصد حفظ آن را دارید، در اکسل تکرار گردند.

>**نکته**<br>
در صورت انتخاب گزینه‌ی «هیچکدام» در قسمت مبنا، گزینه «ورود مقادیر به صورت یکپارچه» به صورت خودکار فعال می‌گردد. چرا که با توجه به عدم وجود مبنای شناسایی، امکان افزودن اطلاعات چندگانه به صورت جداگانه وجود ندارد.

در تمامی حالات فوق توجه داشته باشید هنگامی که ایمیل، تلفن، موبایل یا شماره مشتری به عنوان مبنا انتخاب شوند، باید در اکسل نام آن‌ها به صورت ایمیل پیش فرض، تلفن پیش فرض، موبایل پیش فرض و شماره مشتری درج شده باشند.

>**نکته**<br>
در صورت انتخاب شیوه ورود مقادیر به صورت یکپارچه و انتخاب یکی از فیلدهای چندگانه (موبایل یا تلفن) به عنوان مبنای جستجو در قسمت‌های ۱، ۲ یا ۳،‌ باید یک ستون تحت عنوان موبایل/تلفن پیش‌فرض اضافه کنید. اولین شماره‌ی درج شده در آن ردیف شماره پیش‌فرض بوده و باید در این ستون تکرار شود.

### نگاشت فیلدها
در مرحله سوم، سرستون‌های فایل اکسل در بخش «فیلدهای فایل شما» (شماره ۱) و فیلدهای موجود در آیتم پرداخت‌ در بخش «فیلدهای ماشین شما» (شماره ۲) نمایش داده می‌شود. در واقع در این بخش مشخص می‌شود اطلاعات هر ستون اکسل باید در کدام فیلد وارد شود.

![نگاشت فیلدها در اکسل پرداخت‌](./Images/payment-excel-sync_2.8.3.png)

در صورتی که نام ستون‌های اکسل خود را بر اساس راهنمای تنظیم فایل (بخش اول توضیحات) تنظیم کرده باشید،‌ نگاشت به صورت خودکار انجام می‌گیرد. در غیر این صورت با drag & drop باید نام هر ستون را از بخش فیلدهای فایل شما (سمت راست) به فیلد مربوطه در بخش فیلدهای ماشین شما (سمت چپ) متصل نمایید. در این شرایط برای یافتن عنوان مورد نظر در هر دو بخش می‌توانید از قابلیت جستجو (شماره ۳)‌ استفاده کنید.<br>
پس از نگاشت (اتصال نام ستون به فیلدها) می‌توانید نگاشت خود را ذخیره نمایید (شماره ۴). در صورت استفاده مجدد از این اکسل یا اکسل مشابه برای بارگذاری، با کلیک بر روی نگاشت‌های من (شماره ۵)، نگاشت به صورت خودکار انجام می‌شود. شما می‌توانید نگاشت‌های پرکاربرد خود را در سیستم ذخیره نمایید. در لیست نگاشت‌های من امکان ویرایش یا حذف نگاشت ذخیره شده وجود دارد.<br>
برای هر فیلد می‌توانید مقدار پیش‌فرض تعیین نمایید (شماره ۶). در صورت خالی بودن مقدار فیلد در اکسل، فیلد با مقدار پیش‌فرض که در این قسمت تعریف کرده‌اید پر می‌شود.

### شروع بارگذاری
در صورت بارگذاری موفق اکسل،‌ انجام موفقیت‌آمیز آن در این صفحه اعلام می‌شود. در صورت عدم موفقیت در بارگذاری اطلاعات، پیغام زیر نمایش داده می‌شود.

![ارور فایل اکسل](./Images/payment-excel-upload-result_2.8.3.png)

### بارگذاری ناموفق فایل اکسل

در منوی گزارش‌ها، بخش وضعیت عملیات انبوه می‌توانید نتایج ورود اطلاعات را مشاهده کنید. همچنین در صورت بروز خطا با دانلود فایل اکسل از این بخش می‌توانید خطا و علت خطا را مشاهده نمایید. برای دانلود فایل، بر روی جزئیات رکورد مربوطه کلیک کرده و خروجی اکسل دریافت کنید. در اکسل دریافتی، سطرهای دارای مشکل با رنگ قرمز مشخص شده و در ستون آخر دلیل بروز خطا درج شده است.

>**نکته**<br>
اگر جلوگیری از ثبت اطلاعات تکراری در تنظیمات کلی انجام شده باشد (برای مثال جلوگیری از ثبت تلفن تکراری) در هنگام ورود اطلاعات از طریق اکسل علاوه بر فیلد مبنا، این اطلاعات هم بررسی می‌گردد و در صورت تکراری بودن، ورود اطلاعات انجام نمی‌شود.


## مجوزهای مورد نیاز برای بارگذاری پرداخت‌ از طریق اکسل{#PaymentExcelPermision}

برای ثبت پرداخت‌ از طریق اکسل،‌ کاربر باید دارای مجوزهای زیر باشد:
- **برای افزودن اطلاعات جدید**<br>
برای افزودن اطلاعات جدید (مورد ۱ در تنظیمات بارگذاری فایل) باید مجوز **ذخیره اولیه** زیرنوع پرداخت‌ انتخابی را داشته باشید.
- **برای ویرایش اطلاعات موجود**<br>
برای ویرایش اطلاعات موجود (مورد ۲ در تنظیمات بارگذاری فایل) باید مجوز **ویرایش** زیرنوع پرداخت‌ انتخابی را داشته باشید.
- **برای افزودن و ویرایش**<br>
برای افزودن و ویرایش اطلاعات (مورد ۳ در تنظیمات بارگذاری فایل) باید مجوز **ذخیره اولیه** و همچنین مجوز **ویرایش** زیرنوع پرداخت‌ انتخابی را داشته باشید.
- **برای انتخاب نوع پرداخت‌**<br>
برای انتخاب هر نوع پرداخت‌ نقدی/چکی/اعتباری باید به ترتیب مجوز **تعیین نوع پرداخت‌ نقدی**، **تعیین نوع پرداخت‌ چکی** و **تعیین نوع پرداخت‌ اعتباری** را در زیرنوع پرداخت‌ انتخابی داشته باشید.


>**نکته**<br>
برای افزودن و ویرایش اطلاعات (حالت ۳ در تنظیمات بارگذاری) باید مجوز ذخیره اولیه آیتم و ویرایش آیتم را روی زیرنوع هویت انتخاب شده داشته باشد.

در صورت داشتن مجوز مدیر سیستم و یا مجوز مدیر بانک اطلاعاتی می‌توانید بارگذاری اکسل در تمامی حالت‌ها را به انجام برسانید.