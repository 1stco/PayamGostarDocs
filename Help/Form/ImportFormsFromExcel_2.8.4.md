# ثبت فرم از طریق اکسل

اگر می‌خواهید فرم‌های خود را به صورت یکجا در نرم‌افزار ایجاد کنید می‌توانید از روش ورود اکسلی استفاده نمایید. بدین ترتیب می‌توانید اطلاعات فرم‌های مورد نظر را در اکسل درج نمایید (یا از سایر نرم‌افزارهای خود خروجی بگیرید) و سپس در پیام‌گستر بارگذاری کنید. در این حالت فرم‌های مورد نظر ایجاد شده و اطلاعات آن در فیلدهای مربوطه وارد می‌شود. از این روش می‌توانید برای ویرایش اطلاعات فرم‌های موجود نیز استفاده نمایید.<br>
برای اینکه بارگذاری فرم‌ها بدون مواجهه با خطا و با موفقیت به اتمام برسد، لازم است که قوانین تهیه و بارگذاری اکسل را رعایت کنید. در این راهنما تمامی موارد لازم برای تنظیم صحیح فایل اکسل، به همراه شیوه بارگذاری آن مطرح شده‌است. بدین منظور در این راهنما به موارد زیر می‌پردازیم:<br>
- [شیوه‌ی تهیه و تنظیم فایل اکسل فرم‌ها](#FormExcelSetting)
- [روش بارگذاری فایل اکسل فرم‌ها](#FormExcelUploading)
- [مجوزهای لازم برای بارگذاری اکسل فرم‌ها](#FormExcelPermision)

## تنظیمات فایل اکسل{#FormExcelSetting}
برای ورود اطلاعات فرم‌ها از طریق اکسل، ابتدا باید اکسل مورد نظر را بر اساس فرمت مورد پذیرش نرم‌افزار تنظیم کنید. با توجه به اینکه آیتم فرم، طی شخصی‌سازی و بنا بر نیاز شما ایجاد می‌شود و دارای فیلد پیش‌فرض نمی‌باشد، اکسل مورد نیاز باید بر اساس فیلدهای تعبیه شده در فرم شما در نظر گرفته‌شود. به طور کلی، فایل اکسل شما باید شامل ستون‌های پروفایل مرتبط، عنوان و فیلدهای فرم شما باشد. برای سهولت کار می‌توانید از فایل نمونه که در مرحله اول بارگذاری (که جلوتر ببه آن می‌رسیم) برای ورود اطلاعات خود استفاده کنید.<br>
به عنوان مثال، یک فرم نظرسنجی با فیلدهای زیر را در نظر بگیرید:
- فیلد شناسه خودکار: شماره
- فیلد لیست کشویی: سطح رضایت مشتری
- فیلد متن: توضیحات درخواست
- فیلد تاریخ شمسی: تاریخ پیگیری درخواست
برای بارگذاری اطلاعات فرم فوق از طریق اکسل، به اکسلی مشابه تصویر زیر نیاز داریم.<br>

![تکمیل فایل اکسل نمونه فرم‌ها](./Images/form-excel-sample.png)

تصویر فوق،‌ ستون‌های مورد نیاز برای بارگذاری زیر نوع خاصی از فرم‌ با عنوان فرم «نظرسنجی مشتریان» را بر اساس فیلدهای ایجاد شده در آیتم فرم‌ (که در شخصی‌سازی ایجاد شده‌اند) را نشان می‌دهد. چنانچه از فایل نمونه‌ای که نرم‌افزار به شما می‌دهد استفاده می‌کنید، این فیلدها به صورت خودکار در فایل اکسل قرار داده‌می‌شود.<br>
برای تکمیل اطلاعات اکسل، باید توجه داشته‌باشید که اطلاعات مندرج در هر سلول، متناسب با نوع فیلد مرتبط با آن باشد. هر یک از انواع فیلد در پیام‌گستر، الزامات خاص خود را دارد. برای اینکه اکسل شما بدون مواجهه با خطا بارگذاری شود، هنگام تکمیل اطلاعات به نکات زیر توجه داشته‌باشید: 


- در قسمت پروفایل مرتبط، تنها می‌ةوانید از نام افراد یا شرکت‌هایی که هویت‌های آنان در پیام‌گستر ثبت شده‌اند استفاده کنید. به عبارت دیگر نیاز است که ابتدا پروفایل هویت مرتبط در پیام‌گستر ایجاد شده‌باشد، سپس اقدام به بارگذاری فرم برای وی نمایید. از آنجایی که درج «مرتبط با» برای فرم الزامی نمی‌باشد، می‌توانید این ستون را خالی بگذارید. در این حالت فرم ایجاد شده در سابقه‌ی هیچ هویتی قرار نگرفته و فقط در بخش‌ فرم‌ها و تاریخچه CRM در دسترس است.
- در صورت درج فیلد از نوع «شناسه خودکار« شماره‌های مندرج در اکسل باید مطابق با فرمت تعیین شده در هنگام شخصی‌سازی باشد. یعنی در صورت تعریف پیشوند، پسوند و یا محدودیت ارقام، هنگام تعیین شماره در سلول‌های اکسل، به این الزامات توجه داشته‌باشید.
- در صورت استفاده از فیلدهای تاریخی، فرمت روز/ماه/سال را برای درج تاریخ در سلول‌های اکسل رعایت نمایید.
- امکان ورود اطلاعات فیلدهایی از نوع فایل، تصویر، html، کمپین، برچسب، لیست مرتبط، فیلد آیتم‌های CRM (مثل فیلد پرداخت،‌فاکتور و... به جز فیلد شخص/شرکت)، فیلد اضافه از نوع رنگ، فیلد لیستی از نوع فایل و فیلد لیستی از نوع کاربر/گروه از طریق اکسل وجود ندارد.
- در صورت استفاده از فیلد چک باکس،‌ با استفاده از «بلی» چک باکس تیک خورده و در صورت ذکر «خیر» چک باکس بدون تیک لحاظ می‌شود. البته از عبارات yes/no و true/false و همچنین اعداد 1/0 نیز می‌توانید بدین منظور استفاده نمایید.
- در صورت استفاده از فیلد کاربر، از بین کاربران تعریف شده در نرم‌افزار نام کاربر و یا کد کاربر مورد نظر را در این قسمت درج نمایید.
- برای ورود اطلاعات به فیلدهایی از نوع لیست کشویی فقط از عبارات موجود در لیست می‌توانید استفاده نمایید.چنانچه برای یک فیلد لیست کشویی، دو گزینه با عنوان مشابه تعریف شده‌باشد، ورود اطلاعات (مقداردهی) آن از طریق اکسل با خطا مواجه می‌شود.

>**نکته**<br>
> توجه داشته‌باشید که امکان بارگذاری چند نوع فرم‌ (زیرنوع‌های مختلف) به صورت یکجا وجود ندارد. برای بارگذاری فرم‌، برای هر زیرنوع فرم‌ به یک اکسل جداگانه نیاز دارید.<br>

## مراحل بارگذاری فایل اکسل{#FormExcelUploading}
بارگذاری اکسل در پیام‌گستر، چهار مرحله‌ی اصلی دارد:
### بارگذاری فایل
برای بارگذاری فایل اکسل از مسیر تب **اتوماسیون و فرآیندهای سازمانی** > **فرم‌ها** > **زیرنوع فرم** مورد نظر را انتخاب کنید و وارد صفحه لیست فرم‌ها شوید. بر روی کلید «ورود اطلاعات از اکسل» کلیک کنید تا صفحه بارگذاری به شما نمایش داده‌شود.<br>
در گام اول **نوع** و **زیرنوع** آیتم انتخاب شده نمایش داده‌می‌شود. توجه داشته‌باشید که زیرنوع فرمی که قصد بارگذاری آن را دارید در قسمت زیرنوع انتخاب شده‌باشد. در غیر این صورت، چنانچه زیرنوع فرم به درستی انتخاب نشده‌است، آن را به زیرنوع مورد نظر تغییر دهید.<br>

![بارگذاری اکسل فرم‌ها](./Images/form-excel-upload_2.8.4.png)

با کلیک بر روی کلید فایل نمونه (شماره ۱) می‌توانید قالب نمونه اکسل را فرم‌ نمایید. همان طور که پیش‌تر به آن اشاره شد، در این قالب، ستون‌های مورد نیاز برای درج اطلاعات فرم (بر اساس فرم انتخابی) تعبیه شده‌است.<br>
پس از تنظیم فایل اکسل، با کلیک بر روی کلید بارگذاری فایل (شماره ۲)، فایل مورد نظر را انتخاب و بارگذاری کنید. پس از اتمام بارگذاری، کلید مرحله‌ی بعد (شماره ۳) در پایین صفحه برای شما فعال می‌شود. با کلیک بر روی این کلید، برای اعمال تنظیمات به مرحله‌ی بعدی می‌روید.<br>

### تنظیمات بارگذاری فایل
در این بخش باید تنظیمات لازم جهت تعیین روش ورود اطلاعات را مشخص کنید.

![تنظیمات بارگذاری فایل](./Images/form-excel-setting_2.8.4.png)

**1. افزودن اطلاعات جدید**<br>
با انتخاب این گزینه، تمامی فرم‌های جدید موجود در اکسل بر اساس مبنای انتخابی شما شناسایی و بارگذاری می‌شود. تنها فیلد پیش‌فرض برای مبنای شناسایی در فرم‌ها، فیلد عنوان است. در صورت نیاز به انتخاب مبنای شناسایی می‌توانید از این فیلد و یا سایر فیلدهایی که در فرم ایجاد کرده‌اید بدین منظور استفاده نمایید. توجه داشته‌باشید که اگر فیلدی را به عنوان مینای شناسایی انتخاب می‌کنید، درج اطلاعات در آن سلول الزامی بوده و از ورود اطلاعات تکراری در آن ستون خودداری نمایید.
در مثال فوق، فیلد «شماره» که یکی از فیلدهای تعبیه شده در فرم شماست هم می‌تواند به عنوان مبنای شناسایی انتخاب شود. براساس شماره‌ی فرم‌، جستجوی تکراری بودن انجام شده و در صورت تکراری نبودن فرم‌ (یعنی اگر فرم رضایت مشتری‌ای با این شماره در سیستم وجود نداشته‌باشد)، آن فرم‌ به لیست فرم‌‌ها اضافه می‌شود.<br>

**2. ‌ویرایش اطلاعات موجود**<br>
در این حالت براساس فیلدی که به عنوان مبنا انتخاب شده‌است، جستجو انجام‌می‌شود. در صورت وجود فرم مشابه بر اساس مبنای شناسایی، فرم‌ مربوطه ویرایش شده و اطلاعات موجود در اکسل برای آن درج می‌شود. در صورت  یافت نشدن فرم مشابه،‌ اطلاعات آن سطر از اکسل بارگذاری نخواهدشد. <br>
با انتخاب چک باکس " فقط فیلد‌های خالی پر شوند" تنها فیلدهای خالی فرم مقداردهی شده و فیلدهایی که دارای اطلاعات می‌باشند بدون تغییر باقی می‌مانند.<br>

>**نکته**<br>
> هنگام ویرایش، جستجو فقط در بین فرم‌های موجود از زیرنوع انتخابی انجام می‌شود. فلذا اگر فرمی با مبنای شناسایی یکسان در زیرنوع‌های دیگر یافت شود، فرم‌ مذکور ویرایش نخواهدشد.<br>

**3. افزودن و ویرایش**<br>
در این حالت بر اساس فیلد مبنای انتخاب شده، جستجو انجام می‌شود. در صورت وجود فرم‌ با اطلاعات فیلد مبنا، فرم مربوطه ویرایش می‌شود و در صورت یافت نشدن فرم‌ مشابه، آن رکورد به عنوان فرم‌ جدید به نرم‌افزار اضافه می‌شود.<br>
با انتخاب چک باکس "فقط فیلد‌های خالی پر شوند"،‌ در فرم‌‌هایی که بر اساس فیلد مبنا یافت شده (فرم‌‌های موجود) و نیازمند ویرایش می‌باشند، ‌تنها فیلدهای خالی مقداردهی شده و فیلدهایی که دارای اطلاعات می‌باشند بدون تغییر باقی می‌مانند.<br>

>**نکته**<br>
در حالت ویرایش (حالت ۲ و ۳)، چنانچه بر اساس مبنای جستجو، چند فرم‌ با اطلاعات مورد نظر یافت شود، (مثلا در حالتی که مبنا عنوان فرم‌ است،‌ چند فرم دارای یک عنوان یکسان باشند) ویرایش بر روی هیچ یک از فرم‌‌ها انجام نمی‌گیرد.<br>

به این موضوع توجه داشته‌باشید که در زمان ویرایش، مقادیر مندرج در اکسل جایگزین مقادیر قبلی می‌شوند. بنابراین در صورتی که نیاز است مقادیر جدید بدون حذف مقادیر قبلی به آن‌ها اضافه شوند، باید مقادیر قبلی موجود هر فیلد که قصد حفظ آن را دارید، در اکسل تکرار شوند.<br>
برای ادامه‌ی فرآیند بارگذاری، بر روی کلید مرحله بعدی کلیک کنید.<br>

### نگاشت فیلدها
در مرحله سوم، سرستون‌های فایل اکسل در بخش «فیلدهای فایل شما» (شماره ۱) و فیلدهای موجود در مشخصات فرم‌ در بخش «فیلدهای ماشین شما» (شماره ۲) نمایش داده‌می‌شود. در واقع در این بخش مشخص می‌شود که اطلاعات هر ستون اکسل باید در کدام فیلد فرم‌ وارد شود.<br>
در صورت یکسان بودن نام ستون با نام فیلد مربوطه،‌ نگاشت به صورت خودکار انجام می‌گیرد. در غیر این صورت باید با drag & drop نام هر ستون را از بخش فیلدهای فایل شما (سمت راست) به فیلد مربوطه در بخش فیلدهای ماشین شما (سمت چپ) متصل نمایید. در این شرایط برای یافتن عنوان مورد نظر در هر دو بخش می‌توانید از قابلیت جستجو (شماره ۳)‌ استفاده کنید.<br>

![نگاشت فیلد فرم‌‌ها](./Images/form-excel-mapping_2.8.4.png)

اگر نگاشت خود را به صورت دستی انجام داده‌اید، می‌توانید نگاشت خود را ذخیره نمایید (شماره ۴). در صورت استفاده مجدد از این اکسل یااکسل مشابه برای بارگذاری، با کلیک بر روی نگاشت‌های من (شماره ۵)، نگاشت به صورت خودکار انجام می‌شود. شما می‌توانید نگاشت‌های پرکاربرد خود را در سیستم ذخیره نموده و در وقت خود صرفه‌جویی کنید. در لیست نگاشت‌های من امکان ویرایش یا حذف نگاشت ذخیره شده نیز وجود دارد.<br>
شما این امکان را دارید که برای هر فیلد مقداری را به عنوان مقدار پیش‌فرض (شماره ۶) در نظر بگیرید تا در صورت خالی بودن مقدار فیلد در اکسل، فیلد با مقدار پیش‌فرض که در این قسمت تعریف کرده‌اید پر می‌شود.<br>
برای شروع بارگذاری، روی کلید مرحله بعدی کلیک کنید. <br>

### شروع بارگذاری
بارگذاری فایل ممکن است لحظاتی زمان ببرد. پس از اتمام فرآیند بارگذاری، در صورت بارگذاری موفق اکسل،‌ انجام موفقیت‌آمیز آن در این صفحه اعلام می‌شود. پیشنهاد می‌شود که پس از آن به صفحه‌ی لیست فرم‌‌ها بروید و نتیجه را بررسی کنید. افزوده شدن فرم‌‌های جدید را با مقایسه تعداد فرم‌ها با سطرهای اکسل و ویرایش فرم‌‌ها را با بررسی چند نمونه‌ی تصادفی می‌توانید به راحتی چک کنید.<br>
در منوی گزارش‌ها، بخش وضعیت عملیات انبوه می‌توانید نتایج ورود اطلاعات را مشاهده کنید. اگر فرآیند بارگذاری آغاز شود اما به هر دلیلی امکان بارگذاری برخی سطرها وجود نداشته‌باشد، با دانلود فایل اکسل از این بخش می‌توانید خطا و علت خطا را مشاهده نمایید. برای دانلود فایل، بر روی جزئیات رکورد مربوطه کلیک کرده و خروجی اکسل دریافت کنید. در اکسل دریافتی، سطرهای دارای مشکل با رنگ قرمز مشخص شده و در ستون آخر دلیل بروز خطا درج شده‌است.<br>

![ارور فایل اکسل](./Images/form-upload-error.2.8.4.png)

چنانچه بارگذاری فایل با خطا مواجه شده‌باشد و بارگذاری انجام نشود، پیغامی مشابه تصویر فوق به شما نمایش داده‌می‌شود. توجه داشته‌باشید که در این حالت، به سبب آغاز نشدن فرآیند بارگذاری، امکان دریافت فایل خطا از بخش گزارشات انبوه وجود ندارد. در چنین شرایطی فایل اکسل خود را مجدد بررسی و با فرمت راهنما مطابقت دهید. پس از رفع خطاهای فایل، مجدد اقدام به بارگذاری نمایید. <br>

## مجوزهای مورد نیاز برای بارگذاری فرم‌ از طریق اکسل{#FormExcelPermision}
برای ثبت فرم‌از طریق اکسل،‌ کاربر باید دارای مجوزهای زیر باشد:
- **برای افزودن اطلاعات جدید**<br>
برای افزودن اطلاعات جدید (مورد ۱ در تنظیمات بارگذاری فایل) باید مجوز **ذخیره اولیه** زیرنوع فرم‌ انتخابی را داشته‌باشد.
- **برای ویرایش اطلاعات موجود**<br>
برای ویرایش اطلاعات موجود (مورد ۲ در تنظیمات بارگذاری فایل) باید مجوز **ویرایش** زیرنوع فرم‌ انتخابی را داشته‌باشد.
- **برای افزودن و ویرایش**<br>
برای افزودن و ویرایش اطلاعات (مورد ۳ در تنظیمات بارگذاری فایل) باید مجوز **ذخیره اولیه** و همچنین مجوز **ویرایش** زیرنوع فرم‌ انتخابی را داشته‌باشد.






